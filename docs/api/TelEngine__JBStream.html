<HTML>
<HEAD>
<TITLE>class JBStream</TITLE>

<META NAME="Generator" CONTENT="KDOC ">
</HEAD>
<BODY bgcolor="#ffffff" text="#000000" link="#0000ff" vlink="#000099" alink= "#ffffff">
<TABLE WIDTH="100%" BORDER="0">
<TR>
<TD>
	<TABLE BORDER="0">
		<TR><TD valign="top" align="left" cellspacing="10">
		<h1>class JBStream</h1>
		</TD>
		<TD valign="top" align="right" colspan="1">A Jabber stream. <small><A HREF="#longdesc">More...</A></small></TD></TR>
	</TABLE>
	<HR>
	<TABLE BORDER="0">
		<TR><TH>Full name</TH><TD><code><A HREF="TelEngine.html">TelEngine</A>::JBStream</code></TD></TR>
<TR><TH>Definition</TH><TD><code>#include &lt;<A HREF="libs___yjingle___yatejabber_h.html">libs/yjingle/yatejabber.h</A>&gt;</code></TD></TR>
<TR><TH>Inherits</TH><TD><A HREF="TelEngine__RefObject.html">TelEngine::RefObject</A> <small>[public ]</small></TD></TR>
<TR><TH>Inherited by</TH><TD><A HREF="TelEngine__JBClientStream.html">JBClientStream</A>, <A HREF="TelEngine__JBComponentStream.html">JBComponentStream</A></TD></TR>
<TR><TH><A HREF="full-list-TelEngine__JBStream.html">List of all Methods</A></TH></TR>
	</TABLE>
	</TD>
<TD align="right"><TABLE BORDER="0"><TR><TD><small><A HREF="index-long.html">Annotated List</A></small></TD></TR>
<TR><TD><small><A HREF="header-list.html">Files</A></small></TD></TR>
<TR><TD><small><A HREF="all-globals.html">Globals</A></small></TD></TR>
<TR><TD><small><A HREF="hier.html">Hierarchy</A></small></TD></TR>
<TR><TD><small><A HREF="index.html">Index</A></small></TD></TR>
</TABLE></TD></TR></TABLE>
<h4>Public Types</h4><ul><LI>enum <A HREF="#ref3">State</A> {	Idle        = 0,                 
	Connecting  = 1,                 
	Started     = 2,                 
	Securing    = 3,                 
	Auth        = 4,                 
	Running     = 5,                 
	Destroy     = 6,                 
    }
</LI>
<LI>enum <A HREF="#ref4">Error</A> {	ErrorNone = 0,                   
	ErrorContext,                    
	ErrorPending,                    
	ErrorNoSocket,                   
    }
</LI>
<LI>enum <A HREF="#ref5">Flags</A> {	AutoRestart     = 0x0001,        
	AllowPlainAuth  = 0x0002,        
	NoVersion1      = 0x0004,        
	UseTls          = 0x0008,        
	UseSasl         = 0x0010,        
	StreamSecured       = 0x0100,    
	StreamAuthenticated = 0x0200,    
	NoRemoteVersion1    = 0x0400,    
    }
</LI>
</ul><h4>Public Methods</h4><ul><LI>virtual  &nbsp;<b><A HREF="#ref6">~JBStream</A></b> () 
</LI>
<LI>inline int &nbsp;<b><A HREF="#ref7">type</A></b> ()  const
</LI>
<LI>inline State &nbsp;<b><A HREF="#ref8">state</A></b> ()  const
</LI>
<LI>inline bool &nbsp;<b><A HREF="#ref9">outgoing</A></b> ()  const
</LI>
<LI>inline const String& &nbsp;<b><A HREF="#ref10">name</A></b> ()  const
</LI>
<LI>inline const String& &nbsp;<b><A HREF="#ref11">id</A></b> ()  const
</LI>
<LI>inline JBEngine* &nbsp;<b><A HREF="#ref12">engine</A></b> ()  const
</LI>
<LI>inline const JabberID& &nbsp;<b><A HREF="#ref13">local</A></b> ()  const
</LI>
<LI>inline const JabberID& &nbsp;<b><A HREF="#ref14">remote</A></b> ()  const
</LI>
<LI>inline const SocketAddr& &nbsp;<b><A HREF="#ref15">addr</A></b> ()  const
</LI>
<LI>inline bool &nbsp;<b><A HREF="#ref16">flag</A></b> (int mask)  const
</LI>
<LI>inline Mutex* &nbsp;<b><A HREF="#ref17">streamMutex</A></b> () 
</LI>
<LI>void &nbsp;<b><A HREF="#ref18">connect</A></b> () 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref19">receive</A></b> () 
</LI>
<LI>virtual  Error &nbsp;<b><A HREF="#ref20">sendStanza</A></b> (XMLElement* stanza, const char* senderId = 0) 
</LI>
<LI>JBEvent* &nbsp;<b><A HREF="#ref21">getEvent</A></b> (<A HREF="#u_int64_t">u_int64_t</A> time) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref22">terminate</A></b> (bool destroy, XMLElement* recvStanza, XMPPError::Type error, const char* reason,
	bool send, bool final = false) 
</LI>
<LI>inline void &nbsp;<b><A HREF="#ref23">removePending</A></b> (const String& id, bool notify = false) 
</LI>
<LI>virtual  const String& &nbsp;<b><A HREF="#ref24">toString</A></b> ()  const
</LI>
<LI>virtual  void* &nbsp;<b><A HREF="#ref25">getObject</A></b> (const String& name)  const
</LI>
</ul><h4>Public Static Methods</h4><ul><LI>static  const char* &nbsp;<b><A HREF="#ref26">lookupState</A></b> (int state) 
</LI>
</ul><h4>Public Members</h4><ul><LI>static TokenDict <b><A HREF="#ref27">s_flagName[]</A></b></LI>
</ul><h4>Protected Types</h4><ul><LI>enum <A HREF="#ref28">WaitState</A> {	WaitIdle,                        
	WaitStart,                       
	WaitFeatures,                    
	WaitBindRsp,                     
	WaitTlsRsp,                      
	WaitChallenge,                   
	WaitResponse,                    
	WaitAborted,                     
    }
</LI>
</ul><h4>Protected Methods</h4><ul><LI>&nbsp;<b><A HREF="#ref29">JBStream</A></b> (JBEngine* engine, int type, XMPPServerInfo& info,
	const JabberID& localJid, const JabberID& remoteJid) 
</LI>
<LI>inline &nbsp;<b><A HREF="#ref30">JBStream</A></b> () 
</LI>
<LI>virtual  void &nbsp;<b><A HREF="#ref31">destroyed</A></b> () 
</LI>
<LI>virtual  bool &nbsp;<b><A HREF="#ref32">checkDestination</A></b> (XMLElement* xml, bool& respond) 
</LI>
<LI>virtual  XMLElement* &nbsp;<b><A HREF="#ref33">getStreamStart</A></b> () 
</LI>
<LI>virtual  XMLElement* &nbsp;<b><A HREF="#ref34">getAuthStart</A></b> () 
</LI>
<LI>virtual  void &nbsp;<b><A HREF="#ref35">processRunning</A></b> (XMLElement* xml) 
</LI>
<LI>virtual  void &nbsp;<b><A HREF="#ref36">processAuth</A></b> (XMLElement* xml) 
</LI>
<LI>virtual  void &nbsp;<b><A HREF="#ref37">processSecuring</A></b> (XMLElement* xml) 
</LI>
<LI>virtual  void &nbsp;<b><A HREF="#ref38">processStarted</A></b> (XMLElement* xml) 
</LI>
<LI>virtual  void &nbsp;<b><A HREF="#ref39">streamRunning</A></b> () 
</LI>
<LI>JBEvent* &nbsp;<b><A HREF="#ref40">getIqEvent</A></b> (XMLElement* xml, int iqType, XMPPError::Type& error) 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref41">sendStreamStart</A></b> () 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref42">sendStreamXML</A></b> (XMLElement* e, State newState) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref43">invalidStreamXML</A></b> (XMLElement* xml, XMPPError::Type error, const char* reason) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref44">errorStreamXML</A></b> (XMLElement* xml) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref45">dropXML</A></b> (XMLElement* xml, bool unexpected = true) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref46">changeState</A></b> (State newState) 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref47">getStreamFeatures</A></b> (XMLElement* features) 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref48">startTls</A></b> () 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref49">startAuth</A></b> () 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref50">sendAuthResponse</A></b> (XMLElement* challenge = 0) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref51">buildSaslResponse</A></b> (String& response, String* realm = 0,
	String* nonce = 0) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref52">setClientAuthMechanism</A></b> () 
</LI>
<LI>void &nbsp;<b><A HREF="#ref53">buildDigestMD5Sasl</A></b> (String& dest, bool authenticate = true) 
</LI>
<LI>void &nbsp;<b><A HREF="#ref54">setRecvCount</A></b> (int value) 
</LI>
<LI>bool &nbsp;<b><A HREF="#ref55">startIdleTimer</A></b> (<A HREF="#u_int64_t">u_int64_t</A> time = Time::msecNow()) 
</LI>
<LI>inline JBEvent* &nbsp;<b><A HREF="#ref56">lastEvent</A></b> () 
</LI>
</ul><h4>Protected Members</h4><ul><LI>String <b><A HREF="#ref57">m_name</A></b></LI>
<LI>String <b><A HREF="#ref58">m_password</A></b></LI>
<LI>JIDFeatureList <b><A HREF="#ref59">m_localFeatures</A></b></LI>
<LI>JIDFeatureList <b><A HREF="#ref60">m_remoteFeatures</A></b></LI>
<LI>int <b><A HREF="#ref61">m_flags</A></b></LI>
<LI>unsigned int <b><A HREF="#ref62">m_challengeCount</A></b></LI>
<LI>WaitState <b><A HREF="#ref63">m_waitState</A></b></LI>
<LI>JIDFeatureSasl::Mechanism <b><A HREF="#ref64">m_authMech</A></b></LI>
<LI>ObjList <b><A HREF="#ref65">m_events</A></b></LI>
</ul><HR><H2><A NAME="longdesc">Detailed Description</A></H2><p>
 Base class for all Jabber streams. Basic stream data processing: send/receive
  XML elements, keep stream state, generate events
</p>
<A NAME="State"></A><A NAME="ref3"></A><table width="100%"><tr bgcolor="#eeeeee"><td>enum <strong>State</strong> {	Idle        = 0,                 
	Connecting  = 1,                 
	Started     = 2,                 
	Securing    = 3,                 
	Auth        = 4,                 
	Running     = 5,                 
	Destroy     = 6,                 
    }
</td><td align="right"><h3><strong>State</strong></h3></td></tr></table><p></p><p>
 Stream state enumeration.
     </p>
<A NAME="Error"></A><A NAME="ref4"></A><table width="100%"><tr bgcolor="#eeeeee"><td>enum <strong>Error</strong> {	ErrorNone = 0,                   
	ErrorContext,                    
	ErrorPending,                    
	ErrorNoSocket,                   
    }
</td><td align="right"><h3><strong>Error</strong></h3></td></tr></table><p></p><p>
 Values returned by send() methods.
     </p>
<A NAME="Flags"></A><A NAME="ref5"></A><table width="100%"><tr bgcolor="#eeeeee"><td>enum <strong>Flags</strong> {	AutoRestart     = 0x0001,        
	AllowPlainAuth  = 0x0002,        
	NoVersion1      = 0x0004,        
	UseTls          = 0x0008,        
	UseSasl         = 0x0010,        
	StreamSecured       = 0x0100,    
	StreamAuthenticated = 0x0200,    
	NoRemoteVersion1    = 0x0400,    
    }
</td><td align="right"><h3><strong>Flags</strong></h3></td></tr></table><p></p><p>
 Stream behaviour options
     </p>
<A NAME="~JBStream"></A><A NAME="ref6"></A><table width="100%"><tr bgcolor="#eeeeee"><td> &nbsp;<strong>~JBStream</strong> ()
<br></td><td align="right"><h3><strong>~JBStream</strong></h3></td></tr></table><p> <small>[virtual]</small></p><p>
 Destructor.
 Gracefully close the stream and the socket
     </p>
<A NAME="type"></A><A NAME="ref7"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline int &nbsp;<strong>type</strong> ()
<br></td><td align="right"><h3><strong>type</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the type of this stream. See the protocol enumeration of the engine
</p>
<p><b>Returns</b>: The type of this stream
     </p>
<A NAME="state"></A><A NAME="ref8"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline State &nbsp;<strong>state</strong> ()
<br></td><td align="right"><h3><strong>state</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the stream state
</p>
<p><b>Returns</b>: The stream state as enumeration.
     </p>
<A NAME="outgoing"></A><A NAME="ref9"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline bool &nbsp;<strong>outgoing</strong> ()
<br></td><td align="right"><h3><strong>outgoing</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the stream direction
</p>
<p><b>Returns</b>: True if the stream is an outgoing one
     </p>
<A NAME="name"></A><A NAME="ref10"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline const String& &nbsp;<strong>name</strong> ()
<br></td><td align="right"><h3><strong>name</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the stream's name
</p>
<p><b>Returns</b>: The stream's name
     </p>
<A NAME="id"></A><A NAME="ref11"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline const String& &nbsp;<strong>id</strong> ()
<br></td><td align="right"><h3><strong>id</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the stream id
</p>
<p><b>Returns</b>: The stream id
     </p>
<A NAME="engine"></A><A NAME="ref12"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline JBEngine* &nbsp;<strong>engine</strong> ()
<br></td><td align="right"><h3><strong>engine</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the stream's owner
</p>
<p><b>Returns</b>: Pointer to the engine owning this stream
     </p>
<A NAME="local"></A><A NAME="ref13"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline const JabberID& &nbsp;<strong>local</strong> ()
<br></td><td align="right"><h3><strong>local</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the JID of the local side of this stream
</p>
<p><b>Returns</b>: The JID of the local side of this stream
     </p>
<A NAME="remote"></A><A NAME="ref14"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline const JabberID& &nbsp;<strong>remote</strong> ()
<br></td><td align="right"><h3><strong>remote</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the JID of the remote side of this stream
</p>
<p><b>Returns</b>: The JID of the remote side of this stream
     </p>
<A NAME="addr"></A><A NAME="ref15"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline const SocketAddr& &nbsp;<strong>addr</strong> ()
<br></td><td align="right"><h3><strong>addr</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Get the remote peer's address
</p>
<p><b>Returns</b>: The remote peer's address
     </p>
<A NAME="flag"></A><A NAME="ref16"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline bool &nbsp;<strong>flag</strong> (int mask)
<br></td><td align="right"><h3><strong>flag</strong></h3></td></tr></table><p> <small>[const]</small></p><p>
 Check if a given option (or option mask) is set
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>mask</i></TD><TD align="left" valign="top">The flag(s) to check
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: True if set
     </p>
<A NAME="streamMutex"></A><A NAME="ref17"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline Mutex* &nbsp;<strong>streamMutex</strong> ()
<br></td><td align="right"><h3><strong>streamMutex</strong></h3></td></tr></table><p></p><p>
 Get the stream mutex
</p>
<p><b>Returns</b>: The stream mutex
     </p>
<A NAME="connect"></A><A NAME="ref18"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>connect</strong> ()
<br></td><td align="right"><h3><strong>connect</strong></h3></td></tr></table><p></p><p>
 Connect the stream. Send stream start tag on success
 This method is thread safe
     </p>
<A NAME="receive"></A><A NAME="ref19"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>receive</strong> ()
<br></td><td align="right"><h3><strong>receive</strong></h3></td></tr></table><p></p><p>
 Read data from socket and pass it to the parser. Terminate stream on
  socket or parser error.
 This method is thread safe
</p>
<p><b>Returns</b>: True if data was received
     </p>
<A NAME="sendStanza"></A><A NAME="ref20"></A><table width="100%"><tr bgcolor="#eeeeee"><td> Error &nbsp;<strong>sendStanza</strong> (XMLElement* stanza, const char* senderId = 0)
<br></td><td align="right"><h3><strong>sendStanza</strong></h3></td></tr></table><p> <small>[virtual]</small></p><p>
 Send a stanza.
 This method is thread safe
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>stanza</i></TD><TD align="left" valign="top">Element to send
</TD></TR>
<TR><TD align="left" valign="top"><i>senderId</i></TD><TD align="left" valign="top">Optional sender's id. Used for notification events
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: The result of posting the stanza
     </p>
<A NAME="getEvent"></A><A NAME="ref21"></A><table width="100%"><tr bgcolor="#eeeeee"><td>JBEvent* &nbsp;<strong>getEvent</strong> (<A HREF="#u_int64_t">u_int64_t</A> time)
<br></td><td align="right"><h3><strong>getEvent</strong></h3></td></tr></table><p></p><p>
 Stream state and data processor. Increase restart counter.
 Restart stream if idle and auto restart.
 Extract an element from parser and construct an event.
 This method is thread safe
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>time</i></TD><TD align="left" valign="top">Current time
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: JBEvent pointer or 0
     </p>
<A NAME="terminate"></A><A NAME="ref22"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>terminate</strong> (bool destroy, XMLElement* recvStanza, XMPPError::Type error, const char* reason,
	bool send, bool final = false)
<br></td><td align="right"><h3><strong>terminate</strong></h3></td></tr></table><p></p><p>
 Terminate stream. Send stream end tag or error.
 Remove pending stanzas without id. Deref stream if destroying.
 This method is thread safe
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>destroy</i></TD><TD align="left" valign="top">True to destroy. False to terminate
</TD></TR>
<TR><TD align="left" valign="top"><i>recvStanza</i></TD><TD align="left" valign="top">Received stanza, if any
</TD></TR>
<TR><TD align="left" valign="top"><i>error</i></TD><TD align="left" valign="top">Termination reason. Set it to NoError to send stream end tag
</TD></TR>
<TR><TD align="left" valign="top"><i>reason</i></TD><TD align="left" valign="top">Optional text to be added to the error stanza
</TD></TR>
<TR><TD align="left" valign="top"><i>send</i></TD><TD align="left" valign="top">True to send the error element (ignored if error is NoError)
</TD></TR>
<TR><TD align="left" valign="top"><i>final</i></TD><TD align="left" valign="top">True if called from destructor
     </TD></TR>
</TABLE></P>
<A NAME="removePending"></A><A NAME="ref23"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline void &nbsp;<strong>removePending</strong> (const String& id, bool notify = false)
<br></td><td align="right"><h3><strong>removePending</strong></h3></td></tr></table><p></p><p>
 Remove pending stanzas with a given id.
 This method is thread safe
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>id</i></TD><TD align="left" valign="top">The id of stanzas to remove
</TD></TR>
<TR><TD align="left" valign="top"><i>notify</i></TD><TD align="left" valign="top">True to raise an event for each removed stanza
     </TD></TR>
</TABLE></P>
<A NAME="toString"></A><A NAME="ref24"></A><table width="100%"><tr bgcolor="#eeeeee"><td> const String& &nbsp;<strong>toString</strong> ()
<br></td><td align="right"><h3><strong>toString</strong></h3></td></tr></table><p> <small>[const virtual]</small></p><p>
 Get the string representation of this stream
</p>
<p><b>Returns</b>: The string representation of this stream
     </p>
<p>Reimplemented from <A HREF="TelEngine__GenObject.html#toString">GenObject</A>.</p>
<A NAME="getObject"></A><A NAME="ref25"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void* &nbsp;<strong>getObject</strong> (const String& name)
<br></td><td align="right"><h3><strong>getObject</strong></h3></td></tr></table><p> <small>[const virtual]</small></p><p>
 Get an object from this stream
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>name</i></TD><TD align="left" valign="top">The name of the object to get
     </TD></TR>
</TABLE></P>
<p>Reimplemented from <A HREF="TelEngine__GenObject.html#getObject">GenObject</A>.</p>
<A NAME="lookupState"></A><A NAME="ref26"></A><table width="100%"><tr bgcolor="#eeeeee"><td> const char* &nbsp;<strong>lookupState</strong> (int state)
<br></td><td align="right"><h3><strong>lookupState</strong></h3></td></tr></table><p> <small>[static]</small></p><p>
 Get the name of a stream state
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>state</i></TD><TD align="left" valign="top">The requested state number
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: The name of the requested state
     </p>
<A NAME="s_flagName[]"></A><A NAME="ref27"></A><table width="100%"><tr bgcolor="#eeeeee"><td>static TokenDict  <strong>s_flagName[]</strong>
</td><td align="right"><h3><strong>s_flagName[]</strong></h3></td></tr></table><p></p><A NAME="WaitState"></A><A NAME="ref28"></A><table width="100%"><tr bgcolor="#eeeeee"><td>enum <strong>WaitState</strong> {	WaitIdle,                        
	WaitStart,                       
	WaitFeatures,                    
	WaitBindRsp,                     
	WaitTlsRsp,                      
	WaitChallenge,                   
	WaitResponse,                    
	WaitAborted,                     
    }
</td><td align="right"><h3><strong>WaitState</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Internal wait states enumeration. Defines what kind of XML is expected
     </p>
<A NAME="JBStream"></A><A NAME="ref29"></A><table width="100%"><tr bgcolor="#eeeeee"><td>&nbsp;<strong>JBStream</strong> (JBEngine* engine, int type, XMPPServerInfo& info,
	const JabberID& localJid, const JabberID& remoteJid)
<br></td><td align="right"><h3><strong>JBStream</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Constructor. Build an outgoing stream
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>engine</i></TD><TD align="left" valign="top">The engine that owns this stream
</TD></TR>
<TR><TD align="left" valign="top"><i>type</i></TD><TD align="left" valign="top">Stream type
</TD></TR>
<TR><TD align="left" valign="top"><i>info</i></TD><TD align="left" valign="top">Structure containing data used to connect to remote server
</TD></TR>
<TR><TD align="left" valign="top"><i>localJid</i></TD><TD align="left" valign="top">Local party's JID
</TD></TR>
<TR><TD align="left" valign="top"><i>remoteJid</i></TD><TD align="left" valign="top">Remote party's JID
     </TD></TR>
</TABLE></P>
<A NAME="JBStream"></A><A NAME="ref30"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline &nbsp;<strong>JBStream</strong> ()
<br></td><td align="right"><h3><strong>JBStream</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Default constructor
     </p>
<A NAME="destroyed"></A><A NAME="ref31"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void &nbsp;<strong>destroyed</strong> ()
<br></td><td align="right"><h3><strong>destroyed</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Close the stream. Release memory
     </p>
<p>Reimplemented from <A HREF="TelEngine__RefObject.html#destroyed">RefObject</A>.</p>
<A NAME="checkDestination"></A><A NAME="ref32"></A><table width="100%"><tr bgcolor="#eeeeee"><td> bool &nbsp;<strong>checkDestination</strong> (XMLElement* xml, bool& respond)
<br></td><td align="right"><h3><strong>checkDestination</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Check the 'to' attribute of a received element
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">The received element
</TD></TR>
<TR><TD align="left" valign="top"><i>respond</i></TD><TD align="left" valign="top">Action to be taken when if not accepted.
  True to respond with an error, false to just drop it
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: False to reject it. If the stream is not in Running state,
  it will be terminated
     </p>
<A NAME="getStreamStart"></A><A NAME="ref33"></A><table width="100%"><tr bgcolor="#eeeeee"><td> XMLElement* &nbsp;<strong>getStreamStart</strong> ()
<br></td><td align="right"><h3><strong>getStreamStart</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Get the starting stream element to be sent after stream connected
</p>
<p><b>Returns</b>: XMLElement pointer
     </p>
<A NAME="getAuthStart"></A><A NAME="ref34"></A><table width="100%"><tr bgcolor="#eeeeee"><td> XMLElement* &nbsp;<strong>getAuthStart</strong> ()
<br></td><td align="right"><h3><strong>getAuthStart</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Get the authentication element to be sent when authentication starts
</p>
<p><b>Returns</b>: XMLElement pointer or 0 on failure
     </p>
<A NAME="processRunning"></A><A NAME="ref35"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void &nbsp;<strong>processRunning</strong> (XMLElement* xml)
<br></td><td align="right"><h3><strong>processRunning</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Process a received stanza in Running state
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Valid XMLElement pointer
     </TD></TR>
</TABLE></P>
<A NAME="processAuth"></A><A NAME="ref36"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void &nbsp;<strong>processAuth</strong> (XMLElement* xml)
<br></td><td align="right"><h3><strong>processAuth</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Process a received element in Auth state. Descendants MUST consume the data
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Valid XMLElement pointer
     </TD></TR>
</TABLE></P>
<A NAME="processSecuring"></A><A NAME="ref37"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void &nbsp;<strong>processSecuring</strong> (XMLElement* xml)
<br></td><td align="right"><h3><strong>processSecuring</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Process a received element in Securing state. Descendants MUST consume the data.
 Drop the received element
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Valid XMLElement pointer
     </TD></TR>
</TABLE></P>
<A NAME="processStarted"></A><A NAME="ref38"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void &nbsp;<strong>processStarted</strong> (XMLElement* xml)
<br></td><td align="right"><h3><strong>processStarted</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Process a received element in Started state. Descendants MUST consume the data
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Valid XMLElement pointer
     </TD></TR>
</TABLE></P>
<A NAME="streamRunning"></A><A NAME="ref39"></A><table width="100%"><tr bgcolor="#eeeeee"><td> void &nbsp;<strong>streamRunning</strong> ()
<br></td><td align="right"><h3><strong>streamRunning</strong></h3></td></tr></table><p> <small>[protected virtual]</small></p><p>
 Notify descendants when stream state changed to Running
     </p>
<A NAME="getIqEvent"></A><A NAME="ref40"></A><table width="100%"><tr bgcolor="#eeeeee"><td>JBEvent* &nbsp;<strong>getIqEvent</strong> (XMLElement* xml, int iqType, XMPPError::Type& error)
<br></td><td align="right"><h3><strong>getIqEvent</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Create an iq event from a received iq stanza
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Received element
</TD></TR>
<TR><TD align="left" valign="top"><i>iqType</i></TD><TD align="left" valign="top">The iq type
</TD></TR>
<TR><TD align="left" valign="top"><i>error</i></TD><TD align="left" valign="top">Error type if 0 is returned
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: JBEvent pointer or 0
     </p>
<A NAME="sendStreamStart"></A><A NAME="ref41"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>sendStreamStart</strong> ()
<br></td><td align="right"><h3><strong>sendStreamStart</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Send declaration and stream start
</p>
<p><b>Returns</b>: True on success
     </p>
<A NAME="sendStreamXML"></A><A NAME="ref42"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>sendStreamXML</strong> (XMLElement* e, State newState)
<br></td><td align="right"><h3><strong>sendStreamXML</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Send stream XML elements through the socket
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>e</i></TD><TD align="left" valign="top">The element to send
</TD></TR>
<TR><TD align="left" valign="top"><i>newState</i></TD><TD align="left" valign="top">The new stream state on success
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: False if send failed (stream termination was initiated)
     </p>
<A NAME="invalidStreamXML"></A><A NAME="ref43"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>invalidStreamXML</strong> (XMLElement* xml, XMPPError::Type error, const char* reason)
<br></td><td align="right"><h3><strong>invalidStreamXML</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Terminate stream on receiving invalid elements
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Received element
</TD></TR>
<TR><TD align="left" valign="top"><i>error</i></TD><TD align="left" valign="top">Termination reason
</TD></TR>
<TR><TD align="left" valign="top"><i>reason</i></TD><TD align="left" valign="top">Optional text to be added to the error stanza
     </TD></TR>
</TABLE></P>
<A NAME="errorStreamXML"></A><A NAME="ref44"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>errorStreamXML</strong> (XMLElement* xml)
<br></td><td align="right"><h3><strong>errorStreamXML</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Terminate stream on receiving stanza errors while not running
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Received element
     </TD></TR>
</TABLE></P>
<A NAME="dropXML"></A><A NAME="ref45"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>dropXML</strong> (XMLElement* xml, bool unexpected = true)
<br></td><td align="right"><h3><strong>dropXML</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Drop an unexpected or unhandled element
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>xml</i></TD><TD align="left" valign="top">Received element
</TD></TR>
<TR><TD align="left" valign="top"><i>unexpected</i></TD><TD align="left" valign="top">True if unexpected
     </TD></TR>
</TABLE></P>
<A NAME="changeState"></A><A NAME="ref46"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>changeState</strong> (State newState)
<br></td><td align="right"><h3><strong>changeState</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Change stream's state. Raise a Running event when apropriate
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>newState</i></TD><TD align="left" valign="top">the new stream state
     </TD></TR>
</TABLE></P>
<A NAME="getStreamFeatures"></A><A NAME="ref47"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>getStreamFeatures</strong> (XMLElement* features)
<br></td><td align="right"><h3><strong>getStreamFeatures</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Clear the remote feature list. Parse the received element to fill it up.
 Terminate the stream on error (such as invalid namespace).
 If false is returned, don't re-use the received element
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>features</i></TD><TD align="left" valign="top">Features element to parse
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: False if the stream is terminated
     </p>
<A NAME="startTls"></A><A NAME="ref48"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>startTls</strong> ()
<br></td><td align="right"><h3><strong>startTls</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Start client TLS. Terminate the stream on error
</p>
<p><b>Returns</b>: True if TLS was initiated. False on failure: stream termination was initiated
     </p>
<A NAME="startAuth"></A><A NAME="ref49"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>startAuth</strong> ()
<br></td><td align="right"><h3><strong>startAuth</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Start client authentication. Send first request to authenticate with the server.
 Terminate the stream on error
</p>
<p><b>Returns</b>: False if the stream is terminated
     </p>
<A NAME="sendAuthResponse"></A><A NAME="ref50"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>sendAuthResponse</strong> (XMLElement* challenge = 0)
<br></td><td align="right"><h3><strong>sendAuthResponse</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Send authentication response. Terminate the stream on error
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>challenge</i></TD><TD align="left" valign="top">Received challenge. If non 0 a SASL response is built and sent.
  If 0, a non-SASL response is sent (using handshaking for component and
  XEP-0078 for client streams)
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: False if the stream is terminated
     </p>
<A NAME="buildSaslResponse"></A><A NAME="ref51"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>buildSaslResponse</strong> (String& response, String* realm = 0,
	String* nonce = 0)
<br></td><td align="right"><h3><strong>buildSaslResponse</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Build SASL authentication response (Plain or Digest MD5 SASL).
 A valid mechanism must be previously set
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>response</i></TD><TD align="left" valign="top">Destination string
</TD></TR>
<TR><TD align="left" valign="top"><i>realm</i></TD><TD align="left" valign="top">Received realm or 0 to use local jid. If 0, nonce param is ignored
</TD></TR>
<TR><TD align="left" valign="top"><i>nonce</i></TD><TD align="left" valign="top">Server nonce if available
     </TD></TR>
</TABLE></P>
<A NAME="setClientAuthMechanism"></A><A NAME="ref52"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>setClientAuthMechanism</strong> ()
<br></td><td align="right"><h3><strong>setClientAuthMechanism</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Parse remote's features and pick an authentication mechanism
  to be used when requesting authentication
     </p>
<A NAME="buildDigestMD5Sasl"></A><A NAME="ref53"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>buildDigestMD5Sasl</strong> (String& dest, bool authenticate = true)
<br></td><td align="right"><h3><strong>buildDigestMD5Sasl</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Build a Digest MD5 SASL (RFC 2831) to be sent with authentication responses
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>dest</i></TD><TD align="left" valign="top">Destination string
</TD></TR>
<TR><TD align="left" valign="top"><i>authenticate</i></TD><TD align="left" valign="top">True if building a Digest MD5 challenge response, false if
  building a Digest MD5 to check a 'success' response
     </TD></TR>
</TABLE></P>
<A NAME="setRecvCount"></A><A NAME="ref54"></A><table width="100%"><tr bgcolor="#eeeeee"><td>void &nbsp;<strong>setRecvCount</strong> (int value)
<br></td><td align="right"><h3><strong>setRecvCount</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Safely set receive count
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>value</i></TD><TD align="left" valign="top">The new value of the receive count
     </TD></TR>
</TABLE></P>
<A NAME="startIdleTimer"></A><A NAME="ref55"></A><table width="100%"><tr bgcolor="#eeeeee"><td>bool &nbsp;<strong>startIdleTimer</strong> (<A HREF="#u_int64_t">u_int64_t</A> time = Time::msecNow())
<br></td><td align="right"><h3><strong>startIdleTimer</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Start the idle timer if there are no pending stanzas
</p>
<p><b>Parameters</b>:<TABLE BORDER="0" CELLPADDING="5">
<TR><TD align="left" valign="top"><i>time</i></TD><TD align="left" valign="top">The current time in miliseconds
</TD></TR>
</TABLE></P>
<p><b>Returns</b>: True if started
     </p>
<A NAME="lastEvent"></A><A NAME="ref56"></A><table width="100%"><tr bgcolor="#eeeeee"><td>inline JBEvent* &nbsp;<strong>lastEvent</strong> ()
<br></td><td align="right"><h3><strong>lastEvent</strong></h3></td></tr></table><p> <small>[protected]</small></p><p>
 Get last event from queue
</p>
<p><b>Returns</b>: JBEvent pointer or 0
     </p>
<A NAME="m_name"></A><A NAME="ref57"></A><table width="100%"><tr bgcolor="#eeeeee"><td>String  <strong>m_name</strong>
</td><td align="right"><h3><strong>m_name</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_password"></A><A NAME="ref58"></A><table width="100%"><tr bgcolor="#eeeeee"><td>String  <strong>m_password</strong>
</td><td align="right"><h3><strong>m_password</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_localFeatures"></A><A NAME="ref59"></A><table width="100%"><tr bgcolor="#eeeeee"><td>JIDFeatureList  <strong>m_localFeatures</strong>
</td><td align="right"><h3><strong>m_localFeatures</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_remoteFeatures"></A><A NAME="ref60"></A><table width="100%"><tr bgcolor="#eeeeee"><td>JIDFeatureList  <strong>m_remoteFeatures</strong>
</td><td align="right"><h3><strong>m_remoteFeatures</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_flags"></A><A NAME="ref61"></A><table width="100%"><tr bgcolor="#eeeeee"><td>int  <strong>m_flags</strong>
</td><td align="right"><h3><strong>m_flags</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_challengeCount"></A><A NAME="ref62"></A><table width="100%"><tr bgcolor="#eeeeee"><td>unsigned int  <strong>m_challengeCount</strong>
</td><td align="right"><h3><strong>m_challengeCount</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_waitState"></A><A NAME="ref63"></A><table width="100%"><tr bgcolor="#eeeeee"><td>WaitState  <strong>m_waitState</strong>
</td><td align="right"><h3><strong>m_waitState</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_authMech"></A><A NAME="ref64"></A><table width="100%"><tr bgcolor="#eeeeee"><td>JIDFeatureSasl::Mechanism  <strong>m_authMech</strong>
</td><td align="right"><h3><strong>m_authMech</strong></h3></td></tr></table><p> <small>[protected]</small></p><A NAME="m_events"></A><A NAME="ref65"></A><table width="100%"><tr bgcolor="#eeeeee"><td>ObjList  <strong>m_events</strong>
</td><td align="right"><h3><strong>m_events</strong></h3></td></tr></table><p> <small>[protected]</small></p><HR>
	<table>
	<tr><td><small>Generated by: root on dragoshel on Mon Aug  4 10:38:21 2008, using kdoc 2.0a54.</small></td></tr>
	</table>
</BODY>
</HTML>
